<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Business Logic Overview - MECA</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #1e293b;
            max-width: 1000px;
            margin: 0 auto;
            padding: 40px 20px;
            background: #f8fafc;
        }
        h1 {
            text-align: center;
            color: #ea580c;
            font-size: 2.5rem;
            margin-bottom: 10px;
            border-bottom: 3px solid #ea580c;
            padding-bottom: 15px;
        }
        .subtitle { text-align: center; color: #64748b; font-size: 1.1rem; margin-bottom: 40px; }
        h2 {
            font-size: 1.8rem;
            margin: 40px 0 20px 0;
            padding: 15px;
            background: linear-gradient(135deg, #ea580c 0%, #f97316 100%);
            color: white;
            border-radius: 8px;
        }
        h3 {
            color: #334155;
            font-size: 1.3rem;
            margin: 30px 0 15px 0;
            border-left: 4px solid #ea580c;
            padding-left: 15px;
        }
        p { margin-bottom: 15px; color: #475569; }
        .container {
            background: white;
            border-radius: 12px;
            padding: 30px;
            margin: 20px 0;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }
        th {
            background: linear-gradient(135deg, #ea580c 0%, #f97316 100%);
            color: white;
            padding: 15px;
            text-align: left;
            font-weight: 600;
        }
        td { padding: 12px 15px; border-bottom: 1px solid #e2e8f0; }
        tr:nth-child(even) { background: #f8fafc; }
        tr:hover { background: #fef3c7; }
        .toc {
            background: white;
            border-radius: 12px;
            padding: 25px;
            margin: 30px 0;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }
        .toc h3 { margin-top: 0; border-left: none; padding-left: 0; }
        .toc ul { list-style: none; margin-top: 15px; }
        .toc li { padding: 8px 0; border-bottom: 1px solid #e2e8f0; }
        .toc li:last-child { border-bottom: none; }
        .toc a { color: #ea580c; text-decoration: none; font-weight: 500; }
        .toc a:hover { text-decoration: underline; }
        .info-box {
            background: #eff6ff;
            border: 1px solid #3b82f6;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }
        .info-box h4 { color: #1e40af; margin-bottom: 10px; margin-top: 0; }
        ul, ol { margin-left: 20px; margin-bottom: 15px; }
        li { margin: 8px 0; color: #475569; }
        code {
            background: #f1f5f9;
            padding: 2px 6px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            color: #ea580c;
        }
        .code-block {
            background: #0f172a;
            color: #e2e8f0;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            overflow-x: auto;
            margin: 15px 0;
            white-space: pre;
        }
        .status-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 500;
        }
        .badge-green { background: #dcfce7; color: #166534; }
        .badge-red { background: #fee2e2; color: #991b1b; }
        .badge-yellow { background: #fef3c7; color: #92400e; }
        .badge-blue { background: #dbeafe; color: #1e40af; }
        footer {
            text-align: center;
            margin-top: 50px;
            padding-top: 20px;
            border-top: 2px solid #e2e8f0;
            color: #64748b;
        }
    </style>
</head>
<body>
    <h1>NewMECA V2 - Business Logic Overview</h1>
    <p class="subtitle">Comprehensive overview of business logic for stakeholder review</p>

    <div class="toc">
        <h3>Table of Contents</h3>
        <ul>
            <li><a href="#overview">1. System Overview</a></li>
            <li><a href="#roles">2. User Roles & Permissions</a></li>
            <li><a href="#membership">3. Membership System</a></li>
            <li><a href="#teams">4. Team System</a></li>
            <li><a href="#events">5. Events System</a></li>
            <li><a href="#hosting">6. Event Hosting Request Workflow</a></li>
            <li><a href="#results">7. Competition Results & Points</a></li>
            <li><a href="#payments">8. Payment Processing</a></li>
            <li><a href="#integrations">9. External Integrations</a></li>
        </ul>
    </div>

    <h2 id="overview">1. System Overview</h2>
    <div class="container">
        <p>NewMECA V2 is a full-stack web application for the <strong>Mobile Electronics Competition Association (MECA)</strong> - an organization that manages car audio competitions across the United States.</p>

        <h3 style="margin-top: 20px; border-left: none; padding-left: 0;">Core Capabilities</h3>
        <table>
            <thead>
                <tr>
                    <th>Feature</th>
                    <th>Description</th>
                </tr>
            </thead>
            <tbody>
                <tr><td><strong>Member Management</strong></td><td>User registration, profiles, membership purchases</td></tr>
                <tr><td><strong>Team Management</strong></td><td>Team creation, membership, roles, and collaboration</td></tr>
                <tr><td><strong>Event Management</strong></td><td>Event hosting requests, approval workflows, event listings</td></tr>
                <tr><td><strong>Competition Results</strong></td><td>Result entry, points calculation, leaderboards</td></tr>
                <tr><td><strong>Financial Integration</strong></td><td>Stripe payments, QuickBooks accounting sync</td></tr>
                <tr><td><strong>Public Content</strong></td><td>Event calendars, leaderboards, member directories</td></tr>
            </tbody>
        </table>
    </div>

    <h2 id="roles">2. User Roles & Permissions</h2>

    <h3>Role Definitions</h3>
    <table>
        <thead>
            <tr>
                <th>Role</th>
                <th>Description</th>
                <th>Key Permissions</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td><strong>USER</strong></td>
                <td>Standard member</td>
                <td>View events, register for competitions, manage profile, join/create teams</td>
            </tr>
            <tr>
                <td><strong>EVENT_DIRECTOR</strong></td>
                <td>Assigned to review hosting requests</td>
                <td>Review assigned hosting requests, manage competition results at their events</td>
            </tr>
            <tr>
                <td><strong>RETAILER</strong></td>
                <td>Business/retail member</td>
                <td>Retailer-specific features, business profile</td>
            </tr>
            <tr>
                <td><strong>ADMIN</strong></td>
                <td>System administrator</td>
                <td>Full access: manage users, events, memberships, approve hosting requests</td>
            </tr>
        </tbody>
    </table>

    <h2 id="membership">3. Membership System</h2>

    <h3>Membership Categories</h3>
    <table>
        <thead>
            <tr>
                <th>Category</th>
                <th>Description</th>
                <th>Typical Use</th>
            </tr>
        </thead>
        <tbody>
            <tr><td><strong>COMPETITOR</strong></td><td>Individual competitor membership</td><td>Car audio competitors</td></tr>
            <tr><td><strong>TEAM</strong></td><td>Team membership add-on</td><td>Teams wanting official MECA team status</td></tr>
            <tr><td><strong>RETAIL</strong></td><td>Retail business membership</td><td>Car audio shops/retailers</td></tr>
            <tr><td><strong>MANUFACTURER</strong></td><td>Equipment manufacturer</td><td>Audio equipment manufacturers</td></tr>
        </tbody>
    </table>

    <h3>Payment Status Flow</h3>
    <div class="code-block">PENDING → PAID → (optional) REFUNDED
       ↘ FAILED
       ↘ CANCELLED</div>

    <div class="info-box">
        <h4>Membership Business Rules</h4>
        <ul>
            <li><strong>Guest Checkout:</strong> Memberships can be purchased without an account</li>
            <li><strong>Account Linking:</strong> Orphan memberships are auto-linked when user creates an account</li>
            <li><strong>Membership Duration:</strong> Default is 1 year from purchase date</li>
            <li><strong>Active Definition:</strong> endDate >= current date AND paymentStatus = PAID</li>
        </ul>
    </div>

    <h2 id="teams">4. Team System</h2>

    <h3>Team Member Roles</h3>
    <table>
        <thead>
            <tr>
                <th>Role</th>
                <th>Permissions</th>
            </tr>
        </thead>
        <tbody>
            <tr><td><strong>OWNER</strong></td><td>Full control - edit team, manage all members, change roles, transfer ownership, delete team</td></tr>
            <tr><td><strong>CO_OWNER</strong></td><td>Edit team info, manage members (add/remove below their role), cannot delete team</td></tr>
            <tr><td><strong>MODERATOR</strong></td><td>Add/remove regular members only</td></tr>
            <tr><td><strong>MEMBER</strong></td><td>Basic membership, can view team info and leave</td></tr>
        </tbody>
    </table>

    <div class="info-box">
        <h4>Team Business Rules</h4>
        <ul>
            <li><strong>One Team Per User:</strong> Users can only be a member of one team at a time</li>
            <li><strong>Team Creation Requirement:</strong> Must have active TEAM category membership</li>
            <li><strong>Default Team Capacity:</strong> 50 members maximum (configurable)</li>
            <li><strong>Owner Restrictions:</strong> Team owner must transfer ownership before leaving</li>
        </ul>
    </div>

    <h2 id="events">5. Events System</h2>

    <h3>Event Status Flow</h3>
    <div class="code-block">PENDING → UPCOMING → ONGOING → COMPLETED
                ↘ CANCELLED
NOT_PUBLIC (hidden from public view)</div>

    <h3>Event Types & Point Multipliers</h3>
    <table>
        <thead>
            <tr>
                <th>Event Type</th>
                <th>Multiplier</th>
                <th>Description</th>
            </tr>
        </thead>
        <tbody>
            <tr><td><strong>1x Event</strong></td><td>1x</td><td>Standard local event</td></tr>
            <tr><td><strong>2x Event</strong></td><td>2x</td><td>Regional event (default)</td></tr>
            <tr><td><strong>3x Event (SOUNDFEST)</strong></td><td>3x</td><td>Major SOUNDFEST events</td></tr>
            <tr><td><strong>4x Event</strong></td><td>4x</td><td>Special competitions (SQ, Install, RTA)</td></tr>
        </tbody>
    </table>

    <h2 id="hosting">6. Event Hosting Request Workflow</h2>

    <h3>Status Definitions</h3>
    <table>
        <thead>
            <tr>
                <th>Status</th>
                <th>Description</th>
            </tr>
        </thead>
        <tbody>
            <tr><td><span class="status-badge badge-yellow">PENDING</span></td><td>New request submitted, awaiting admin review</td></tr>
            <tr><td><span class="status-badge badge-blue">ASSIGNED_TO_ED</span></td><td>Admin assigned to an Event Director</td></tr>
            <tr><td><span class="status-badge badge-blue">ED_REVIEWING</span></td><td>Event Director is reviewing the request</td></tr>
            <tr><td><span class="status-badge badge-green">APPROVED</span></td><td>Request approved, event created</td></tr>
            <tr><td><span class="status-badge badge-red">REJECTED</span></td><td>Request rejected</td></tr>
            <tr><td><span class="status-badge badge-red">CANCELLED</span></td><td>Request cancelled by requestor</td></tr>
        </tbody>
    </table>

    <h2 id="results">7. Competition Results & Points</h2>

    <h3>Eligible Competition Formats</h3>
    <p>Only these formats earn points toward standings:</p>
    <table>
        <thead>
            <tr>
                <th>Format</th>
                <th>Description</th>
            </tr>
        </thead>
        <tbody>
            <tr><td><strong>SPL</strong></td><td>Sound Pressure Level (loudness)</td></tr>
            <tr><td><strong>SQL</strong></td><td>Sound Quality League</td></tr>
            <tr><td><strong>SSI</strong></td><td>Show and Shine Install</td></tr>
            <tr><td><strong>MK</strong></td><td>MECA Kids</td></tr>
        </tbody>
    </table>

    <h3>Points by Placement</h3>
    <table>
        <thead>
            <tr>
                <th>Placement</th>
                <th>1x Event</th>
                <th>2x Event</th>
                <th>3x Event</th>
                <th>4x Event</th>
            </tr>
        </thead>
        <tbody>
            <tr><td><strong>1st</strong></td><td>5</td><td>10</td><td>15</td><td>20</td></tr>
            <tr><td><strong>2nd</strong></td><td>4</td><td>8</td><td>12</td><td>19</td></tr>
            <tr><td><strong>3rd</strong></td><td>3</td><td>6</td><td>9</td><td>18</td></tr>
            <tr><td><strong>4th</strong></td><td>2</td><td>4</td><td>6</td><td>17</td></tr>
            <tr><td><strong>5th</strong></td><td>1</td><td>2</td><td>3</td><td>16</td></tr>
            <tr><td><strong>6th+</strong></td><td>0</td><td>0</td><td>0</td><td>0</td></tr>
        </tbody>
    </table>

    <div class="info-box">
        <h4>Point Eligibility Rules</h4>
        <p>A competitor earns points only if ALL of the following are true:</p>
        <ul>
            <li>MECA ID is NOT <code>999999</code> (guest competitor)</li>
            <li>MECA ID is NOT <code>0</code> or <code>null</code> (unassigned)</li>
            <li>MECA ID does NOT start with <code>99</code> (test/special entries)</li>
            <li>Membership status is <code>active</code></li>
            <li>Membership is NOT expired</li>
        </ul>
    </div>

    <h2 id="payments">8. Payment Processing</h2>
    <div class="container">
        <h3 style="margin-top: 0; border-left: none; padding-left: 0;">Payment Flow</h3>
        <ol>
            <li>User selects membership type</li>
            <li>Frontend creates PaymentIntent via API</li>
            <li>Backend validates membership config is active</li>
            <li>Backend creates Stripe PaymentIntent with metadata</li>
            <li>Frontend displays Stripe checkout</li>
            <li>User completes payment</li>
            <li>Stripe sends webhook: <code>payment_intent.succeeded</code></li>
            <li>Backend creates membership record</li>
            <li>User sees confirmation</li>
        </ol>
    </div>

    <h2 id="integrations">9. External Integrations</h2>
    <table>
        <thead>
            <tr>
                <th>Service</th>
                <th>Purpose</th>
            </tr>
        </thead>
        <tbody>
            <tr><td><strong>Stripe</strong></td><td>Payment processing</td></tr>
            <tr><td><strong>QuickBooks</strong></td><td>Accounting sync</td></tr>
            <tr><td><strong>Twilio</strong></td><td>SMS notifications</td></tr>
            <tr><td><strong>reCAPTCHA v3</strong></td><td>Form spam protection</td></tr>
            <tr><td><strong>Supabase</strong></td><td>Database + Authentication</td></tr>
        </tbody>
    </table>

    <footer>
        <p>MECA Competition System - Business Logic Overview</p>
        <p style="font-size: 0.9rem; margin-top: 5px;">Last Updated: December 2025</p>
    </footer>
</body>
</html>
